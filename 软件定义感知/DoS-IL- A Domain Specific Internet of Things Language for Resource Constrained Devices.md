DoS-IL: 用于资源受限设备的特定领域物联网语言

使资源有限的设备能够连接到互联网的常见方法是通过编程指令并将其转移到嵌入式设备。这个过程涉及各种工具和交叉编译的代码，取决于平台架构。在实际的物联网应用中，由于存在大量的节点，这个过程几乎变得不可能，因为涉及到异质平台和协议以及部署条件。

**本文介绍了一种灵活的、可扩展的方法，通过客户端-服务器-服务器-客户端的架构client-server-server-client architecture，增强了可修改性和可编程性。它允许在部署后通过用特定领域语言DoS-IL编写的轻量级脚本改变系统的行为，并存储在雾层的网关中。一个嵌入式的资源浏览器被用来请求和执行该脚本。讨论了这个模型的分析结果和沿途开发的工具。**



卡内基梅隆大学（CMU）1的学生的可乐机在三十年后发展、改革并引入物联网（IoT），成为科技行业的主导。来自CMU的学生使一台可乐自动售货机能够连接到网络，并公布苏打水的可用性和温度。自过去五年以来，人们经常听到类似的故事，许多能够连接到互联网的小工具都在发布它们的状态。这些消费产品具有不同的结构和通信协议，并被编程为通常以预先配置的方式工作。当有更新时，会从制造商的服务器推送到这些设备，在大多数情况下，设备会将数据发送到由服务提供商建立的云服务。

无论系统的目的是什么，物联网的一般定义是嵌入物理对象的设备的自主网络，这些设备能感知内部或环境变化或修改状态，并随时通过互联网进行通信。据估计，在未来几年内，将有数百亿这样的设备连接到互联网上。这种相互通信和对互联网的访问使它们能够实现智能化，并推动广泛的应用。物联网预计将改变目前生活中许多方面的流程。由于物联网有如此多的潜在前景，有许多挑战需要解决。
计算的趋势是向更便宜、更小和更快的设备普遍发展。这是物联网进步的推动因素之一，也是物理对象中的嵌入式设备无处不在的性质。然而，它也带来了自己的挑战；这些设备中的大多数都受到资源的限制，无法以传统的方式对信息进行本地化的处理和存储。这些设备在可用于存储的内存量、处理能力、通信带宽和可用的电力（电池或收割）方面受到限制。此外，物联网的主要通信模式是无线的，而且已经有多种多样的此类协议。除了协议上的差异，还有平台和格式上的差异，限制了整合的可能性。这种差异迫使系统开发者利用一系列的工具，并需要各种技能来编程。例如，互操作性中间件4是常见的解决方案。回顾分布式计算的历史方法，为了应对资源限制，客户端设备经历了计算和编程方法的工作负荷变化。渐渐地，在世界范围内，这种方法已经转变为一个更多的协议不可知的客户服务器架构，通过通用的客户端浏览器请求信息，并解析传入的数据，将其呈现给用户。

卡内基梅隆大学（CMU）1的学生的可乐机在三十年后发展、改革并引入物联网（IoT），成为科技行业的主导。来自CMU的学生使一台可乐自动售货机能够连接到网络，并公布苏打水的可用性和温度。自过去五年以来，人们经常听到类似的故事，许多能够连接到互联网的小工具都在发布它们的状态。这些消费产品具有不同的结构和通信协议，并被编程为通常以预先配置的方式工作。当有更新时，会从制造商的服务器推送到这些设备，在大多数情况下，设备会将数据发送到由服务提供商建立的云服务。无论系统的目的是什么，物联网的一般定义是嵌入物理对象的设备的自主网å络，这些设备能感知内部或环境变化或修改状态，并随时通过互联网进行通信2。据估计，在未来几年内，将有数百亿这样的设备连接到互联网上。这种相互通信和对互联网的访问使它们能够实现智能化，并推动广泛的应用。物联网预计将改变目前生活中许多方面的流程3。由于物联网有如此多的潜在前景，有许多挑战需要解决。
计算的趋势是向更便宜、更小和更快的设备普遍发展。这是物联网进步的推动因素之一，也是物理对象中的嵌入式设备无处不在的性质。然而，它也带来了自己的挑战；这些设备中的大多数都受到资源的限制，无法以传统的方式对信息进行本地化的处理和存储。这些设备在可用于存储的内存量、处理能力、通信带宽和可用的电力（电池或收割）方面受到限制。此外，物联网的主要通信模式是无线的，而且已经有多种多样的此类协议。除了协议上的差异，还有平台和格式上的差异，限制了整合的可能性。这种差异迫使系统开发者利用一系列的工具，并需要各种技能来编程。例如，互操作性中间件是常见的解决方案。回顾分布式计算的历史方法，为了应对资源限制，客户端设备经历了计算和编程方法的工作负荷变化。渐渐地，在WWW内，这种方法已经转变为一个更多的协议不可知的客户服务器架构，通过通用的客户端浏览器请求信息，并解析传入的数据，将其呈现给用户。

随着物联网中数十亿设备的引入，嵌入式设备和云的客户服务器配置已经被修改为中间的雾计算层5。该层处于一个理想的位置，支持下层的嵌入式设备的限制，或通常被称为感知层。它提供了具有实时反馈的低延迟通信，并将计算、存储和网络服务带到嵌入式设备附近。这一层的特点是广泛的地理分布、位置感知和物理接近，可以利用它来提供广泛的服务。本文利用雾层来增强感知层的可编程性，引入了一种物联网领域的特定语言，可用于编写存储在雾层的脚本，并由感知层的设备访问。本文的主要贡献是：

- 用于资源受限设备的DSL（DoS-IL）。

- 由DoS-IL操作的设备对象模型（DOM）。

- 坐落在对象浏览器中的DoS-IL的轻量级解释器

在讨论语言、解释器和资源浏览器的实现细节之前，我们强调了物联网的限制，以激励DoS-IL的重要性。在第2节中，对物联网的挑战进行了修订，并显示了对新的可编程性方法的需求。在随后的章节中，介绍了系统的总体架构（第3节），更详细地描述了DoS-IL，并进行了详细的分析（第4节）。第5节介绍了该工作的分析。最后两部分介绍了其他相关的物联网领域规范化语言和研究，提高了物联网的可编程性、可扩展性和互操作性，在第6节，最后一节是总结性发言。



2. 物联网的挑战
为了确定物联网的挑战并激发对新方法的需求，考虑这样一个场景：物联网应用由多个具有不同平台架构的设备组成，使用各种通信协议，由成千上万的设备组成。开发者开始选择最适合的嵌入式操作系统，或者可以选择不使用操作系统。在这种情况下，根据对硬件平台架构和通信协议的支持，也有广泛的嵌入式操作系统可供选择。从所有这些中挑选出最适合的后，逻辑的实际编程取决于所选的操作系统、协议和平台。该程序在主机中被交叉编译，并传输到终端设备上。鉴于物联网系统的性质，这些设备被部署在远程位置或嵌入到物理对象中。在更高级的情况下。

它可以被部署在几乎不可能进行物理访问的地方。在这种情况下，把这些设备带回来修改部分编程逻辑是不现实的。此外，看看预期的部署规模，为每个设备经历上述过程是繁琐的，几乎不可能。通信协议和数据格式的多样性增加了异质性的维度，使问题更加严重。在互操作性方面有许多尝试，通过引入中间件4来隐藏基础平台和协议的变化。其中一些中间件解决方案面临着缺乏足够的资源来承载内存和计算需求中的额外开销的挑战。

本文提出的解决方案受到分布式和网络化系统中早期方法的启发。在网络化和分布式系统的早期，不同规模的类似挑战已经被充分研究。为了探索相似性和提取最佳方法，我们对早期的方法进行了反思。Tanenbaum和Van Renesse6讨论了分布式系统和网络化系统，并强调了每个类别的设计问题。此外，Fielding7概述了网络架构的设计挑战；其中一些挑战是可扩展性和可伸缩性。Tim Berners-Lee爵士8解释了在引入万维网之前的时代，充满了异质的网络、磁盘格式、数据格式和字符编码。网络的设计目标是克服这些挑战，简化信息共享。Fielding 7在他的博士论文中，讨论了REST（Representational State Transfer）架构风格，也提出了为克服挑战所遵循的方法。目前的物联网编程和部署，在异质性和编程方法方面，处于与网络之前的时代相当的阶段。本文介绍了一种在雾层包括应用控制脚本的方法，以扩大和扩展物联网系统。下一节给出了DoS-IL的详细的架构方面。



3. 系统结构
将传感器或执行器设备连接到物联网的方法之一是通过直接云通信。然而，这种方法带来了许多挑战，并受限于本地资源的可用性。与云的通信有更高的延迟，需要更多的能量，并支持能够基于IP的通信的设备。然而，如前所述，大多数物联网设备都以低功耗的无线协议为主，其中一些协议不是基于IP的，它们的内存受到限制，系统要求实时或低延迟的反馈。这些物联网需求随着大量的传感器和执行器加入网络，雾计算已被确定为一个推动因素。在本文中，雾计算层的作用不仅仅是作为感知层中传感器数据的汇入层，而是一个基本的服务器层，利用程序逻辑，如图1所示。这在感知层和雾层之间形成了客户-服务器通信。从雾层往上看云层，不管各层的能力如何，这两个物理层是相互补充的。系统的用户大多通过云端访问物联网应用，以便在多个地理分布的雾层设备上对系统有一个全面的了解。也可以通过雾层的本地网关访问系统，获得系统的本地化信息和通知。这种架构形成了两个客户端-服务器安排的融合，有效地组成了本文所说的客户端-服务器-服务器-客户端形式。
本文提出的整体架构如图1所示。图中显示了物联网设备的三层物理和功能分离。如图所示，DoS-IL的主要作用是在雾计算层和感知或传感器层的资源受限设备之间。用DoS-IL编写的脚本存储在雾层的网关中，以便在部署后方便维护和修改，而不需要实际访问终端节点。脚本将根据目标设备的唯一ID，或功能相似的设备组来组织。脚本的版本信息被修改，以反映目标设备的相应更新，拉出最新的版本。只有当有新的版本或有新的设备请求时，网关才会将脚本提供给终端节点。在目标节点上，第4.1节中讨论的设备对象模型为DoS-IL脚本暴露了可用的资源，供其操作。脚本由DoS-IL解释器解释，嵌入到感知层的设备资源浏览器中。



4. 物联网特定领域编程
  特定领域语言（DSL）是针对特定应用领域的专门形式的编程语言，以简化实施过程。相比之下，通用编程语言是通用的，可以用来解决许多应用领域的一系列问题。即使特定领域的语言在该领域之外的使用受到限制，它也可以用来编写高效的代码来解决目标领域的问题。已经有一系列的物联网DSL，以提高可编程性或简化物联网系统的不同组件的布线过程。其中一些DSL将在第6节讨论。在讨论差异之前，以下各小节将对DoS-IL及其组件进行概述。
  4.1. 设备对象模型 Device Object Model
  在这项工作中，设备对象模型（DOM）的概念受到文档对象模型9的影响。

  设备对象模型是一个与平台和语言无关的接口，这样程序就可以操作其元素。它有助于格式化内容的呈现，同时实现动态更新内容的方式。HTML文档的文档对象模型是用HTML元素分层构建的，JavaScript可以用来在运行时对其进行操作。例如，HTML文档的根元素有head和body，其中body可以有Div或H1等元素。当客户端从服务器上请求一个内容时，信息就会以Html的结构形式出现，同时还有JavaScript代码来动态地改变格式。类似于这种事件流，资源受限的客户可以用设备对象模型（DOM）来表示。在这项工作中，DOM代表了受限设备中可用的资源；这些资源可以是硬件资源或通过网络与外部世界共享的资源，如传感器读数或存储、内存或电池电量的私人资源。DOM组织并公开了设备中的可用资源。图2a显示了为配合DoS-IL而创建的初始设备对象模型。DOM下有三个主要的孩子。首先，限制设备的私有只读资源，如网络协议、内存和电池值都在这个类别中。中间的类别包含设备的功能组件，如传感器、执行器和事件。最后一类是识别设备并提供其他相关信息，如上下文、位置和环境条件，以及识别标签（如果有）。
  设备对象模型中受保护的元素是被操纵的主要元素，以改变设备的行为和功能。它包含，传感器、执行器和发生在设备中的事件。考虑到某个设备节点在物联网系统中的互动；有外部设备对传感器的值感兴趣，它就提供这些信息，或者它对从另一个设备上读取值感兴趣，以便使用本地执行器采取行动，或者它听从其他外部或内部事件。这三个主要元素中的每一个都有属性、行为和元数据信息在DOM中表示。关于这些元素的元数据包含其独特的标识符或最后出现的时间戳。一个设备的DOM被暴露出来，并通过使用DoS-IL编写的脚本进行操作。在下面的章节中，将详细解释脚本DSL。

4.2 DSL

在物联网设备中，有一套基本的操作程序。根据物联网架构模型IoT-A10中提出的信息和通信模型，有一些抽象的东西有助于设计我们的DSL。看一下图2b中简化的物联网领域模型10，一个物理设备得到了传感器、执行器和标签的支持，形成一个增强的实体。这些元素有不同的功能，属于同一个类，显示为设备。以类似的方式，IoT-A提供了这些实体所遵循的通信模型；用户-服务交互，服务-服务交互，以及服务-资源-设备交互。这些可以被总结为请求、响应、发布或订阅。发布 "可用于读取传感器信息并发送至远程目的地，"请求 "可用于从远程位置获取信息，并由 "响应 "来回答，"订阅 "可用于通知外部事件。作为对这些通信要求的回应，设备以不同方式行事。例如，为了处理 "发布 "类型的通信，设备被编程为读取传感器数据并在指定时间间隔内发送信息。这个程序是用一般的编程语言编写的，并进行交叉编译，然后上传到设备上。一旦设备部署在某一地点，修改代码将涉及再次经历这一过程，或使用其他设备管理协议11来处理更新过程。同样地，一个根据传感器提供的信息行事的执行器从远程传感器或本地传感器接收信息并操作其功能。为了证明我们的物联网DSL的不同之处，考虑以下用DoS-IL编写的示例代码（如图3所示）。该代码的功能是等待设备初始化DOM，并每隔12ms连续循环一次，以检查由独特的ID识别的传感器的读数，例如4。如果它的值超过了某个值（12.35），就操纵执行器（旋转）或等待一个事件的发生。当事件发生且参数值为负值时，它将传感器值发送到服务器，最后设备进入睡眠模式。这段代码被写入并存储在雾层的DoS-IL存储中，如图1所示。传感器节点中的资源浏览器，或带有传感器和执行器的板子，访问这个脚本，解释器执行这个代码。下一节介绍了从雾层访问这种脚本的资源浏览器。



4.3. 资源浏览器 Resource Browser
资源浏览器作为设备的主要软件平台的一部分被整合。它集成了DoS-IL的解释器，并根据来自Fog层的指令对DOM进行操作。它是一个通用的应用软件层，可以发现4个附近的雾层设备并请求执行脚本。这个浏览器和它的集成解释器足够轻巧，适合于资源有限的设备。解释器在这个初始版本中是自包含的；它有一个tokenizer，将指令分解成较小的token，根据DoS-IL语法对其进行label，将token分组为指令和表达式来执行它们。

然而，为了使其更加轻便，预处理任务可以由Fog层完成，浏览器的功能将是简单地执行表达式和指令。脚本保持着一个层次结构，使其在浏览器中容易执行。一个DoS-IL脚本有两个主要部分；设置或检查和重复部分set-up or check and repeat sections .  各部分包含组织语句的块。



5. 分析DoS-IL
前面已经简要提到，在一个典型的DoS-IL脚本中存在两个主要部分。设置部分确保设备被初始化，并且DOM是由本地可用的设备组成的（到图3的第4行为止）。剩下的部分在设备初始化成功后执行。考虑图3中的代码列表，其DOM结构如图2a所示。在分析阶段的开始，解释器从语言结构中识别DOM元素。在这个示例脚本中，它假设所考虑的设备包含了几个内置在同一板上的传感器和执行器。然而，每块板上有单个传感器或执行器的情况是微不足道的（图3中的第二个代码）。在这个示例脚本中，有四个DOM元素；它们是设备、传感器、事件和执行器。设备元素是其他元素的父元素，包含改变整个平台的行为。参考图2a中的DOM，设备上下文和私有资源都通过设备元素暴露出来。DoSIL定义了几种类型来处理各种类别的变量；snumber、sformat和sval分别代表数字数据、数据格式化和有格式化的值。此外，还有确定事件流的语法词、条件词和等待语句。
解释器首先将脚本分割成令牌，确定每个令牌的功能，并以方便执行的方式构造它。例如，上面左边的脚本首先被分成125个标记，每个标记都被贴上了以下类别之一。DOM元素，类型，变量，常量，语言结构，或操作符。例如，看上面的代码列表，'while'被归类为语言结构，'('为操作符，'device'为DOM元素，'ready()'作为DOM元素的一部分与设备有关。这些标记被组织成可执行脚本的构建块，分为块、语句和表达式。一个脚本有两个部分，一个部分有块，一个块有语句或语句的块，一个语句有表达式。例如，图3的左边脚本形成了15个语句、28个表达式和5个块。在这个版本中，一个语句中允许的表达式数量是有限制的。与sections, statements and expressions根据其功能而变化不同，所有的块在功能上是相似的。类似于section的功能差异，有四种类型的statement；wait, DOM call, assignment and conditional statements.。表达式也被标记为变量、常量、调用或声明表达式。从上面的示例代码来看，脚本的第一行是一个等待语句，里面包含一个调用表达式，用来检查设备是否准备好了。一旦确定了语句、块和表达式，执行起来就很简单了。
脚本按顺序执行，除了在条件语句中要跳到适当的位置。解释器有一个指向令牌的指针，作为程序计数器，条件语句将指针移到正确的位置。它还有一个堆栈来存储脚本中声明的变量和值。嵌入资源浏览器中的DSL解释器的大小只有76KB。为了比较这个架构和我们的DSL的性能，考虑一下部署后管理应用修改的另一种方式。例如，开放移动联盟（OMA）11有一个轻量级的M2M解决方案，在设备管理方面有好处。OMA轻量级有客户端和服务器端的解决方案，在其他优势中协作提供更新。然而，它依赖于CoAP，并排除了物联网中许多通过非IP网络通信的设备。相比之下，DoS-IL可以在任何通信协议中传输，由于DoS-IL的紧凑设计，脚本的大小非常小。例如，图3所示的脚本在左边和右边分别只有527字节和292字节。这可以很容易地通过许多低功率网络协议中的有限带宽在一个数据包中传输。此外，实现像网络一样的结构为扩展提供了广泛的可能性。表1总结了DoS-IL的语言结构。这些标记分为三类：决定执行流程的关键词、有助于简化代码编写的运算符（部分）和DOM元素。



6 相关工作

特定领域语言（DSL）在企业应用领域很常见。DSL处理的是特定领域的问题。例如，SQL（结构化查询语言）--一种在关系型数据存储中管理数据的DSL，以及HTML（超文本标记语言）--一种创建和表示网络文档结构的语言，都是非常有名的。在物联网领域，有一些关于DSL的建议来克服物联网的挑战。这些DSL的提议大多是为了帮助简化创建工作流的过程。DSL-4-IoT13是一个集成开发环境和图形化编程方法，旨在简化物联网的编程复杂性并克服异质性。它生成的代码将被插入openHAB14，这是一个智能家居的技术无关的平台。即使它解决了互操作性和可编程性的挑战，DSL-4-IoT在扩展性和可扩展性方面也是有限的。类似的方法已经在Node-RED15中提出，以简化编程方法。Eterovic等人16通过基于UML的可视化编程来处理物联网系统的编程问题，以提高其对没有工程背景的人的可用性。扩展和修改物联网系统的挑战也不是这项工作的重点。Sneps-Sneppe等人17提出了一个基于网络的物联网DSL，以解决物联网编程的挑战。
另一个用于物联网编程和与其他服务整合的DSL是IFTT18。有一些服务小程序，即集成形成某些功能的构建块。它使从社交网络和其他平台组装功能的过程更容易。Midgar19是另一个用于物联网的图形DSL，以简化编程过程，使非开发人员更容易集成。与这些DSL建议相比，DoS-IL有某些相似之处和独特的贡献；可编程性是这些建议和DoS-IL的共同议程。然而，DoS-IL的目标是同时解决可扩展性和可修改性或可扩展性。正如前几节所介绍的，DoS-IL在开发过程中并没有在目标设备上生成和安装；它被写入和存储在雾层，并在感知层的设备上运行。此外，这项工作还引入了一个设备对象模型，简化了在运行时对应用行为的修改。



7. 总结
物联网承诺在生活的不同领域为人类带来广泛的利益。目前确定的应用领域仅仅是冰山一角。然而，在其目前的状态下，物联网有多种挑战，开启了积极的研究领域。可扩展性、互操作性、可扩展性和可编程性是这些挑战中的一部分，是这项工作的目标。与目前使用高级语言对资源受限的设备进行限制扩展、修改和部署后的可扩展性的，编程方式不同，这项工作提倡一种相反的方法，客户节点的行为可以从雾层的网关动态改变。这种范式的改变需要某些工具，这里也介绍一下。一个独立于平台的设备对象模型（DOM）被用来组织和暴露设备中的资源，DoS-IL是一种特定领域的语言，它是为了实现这种范式的改变而开发的，它带有一个轻量级的解释器和一个资源浏览器。解释器的内存占用只有76KB，它是资源浏览器的主要组成部分。编写的脚本的大小取决于应用逻辑；然而，这里提供的样本脚本表明，它足够紧凑（小于一KB），而且一般来说，传输的规模很小。暴露的DOM接口是通用的，实现方式根据目标设备的可用资源而不同。解释器的源代码、样本代码和带有模拟实现的DOM接口都可以在Github上找到12。网关中的脚本服务器的开发和增强的设备管理将在解释器和资源浏览器的后续改进中进行开发。


